<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Checker - Ricochet Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #111;
            color: #fff;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #4CAF50;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #222;
            border-radius: 8px;
            border: 1px solid #333;
        }
        .asset-list {
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
        }
        .asset-item {
            display: contents;
        }
        .asset-path {
            font-family: monospace;
            font-size: 14px;
            color: #ccc;
        }
        .asset-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            min-width: 60px;
        }
        .status-ok {
            background: #4CAF50;
            color: white;
        }
        .status-error {
            background: #f44336;
            color: white;
        }
        .status-checking {
            background: #ff9800;
            color: white;
        }
        .asset-size {
            font-size: 12px;
            color: #888;
            text-align: right;
            min-width: 80px;
        }
        .summary {
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }
        .summary-success {
            background: #1b5e20;
            color: #c8e6c9;
        }
        .summary-error {
            background: #b71c1c;
            color: #ffcdd2;
        }
        .summary-warning {
            background: #e65100;
            color: #ffccbc;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 10px;
            background: #2196F3;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }
        .btn:hover {
            background: #1976D2;
        }
        .btn-success {
            background: #4CAF50;
        }
        .btn-success:hover {
            background: #45a049;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.3s ease;
        }
        .legend {
            display: flex;
            gap: 20px;
            margin: 10px 0;
            font-size: 14px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Asset Checker</h1>
        <p style="text-align: center; color: #ccc;">
            Verifying all game assets are present and accessible
        </p>

        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div style="text-align: center; margin: 10px 0;">
            <span id="progressText">Preparing to check assets...</span>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color status-ok"></div>
                <span>Found</span>
            </div>
            <div class="legend-item">
                <div class="legend-color status-error"></div>
                <span>Missing</span>
            </div>
            <div class="legend-item">
                <div class="legend-color status-checking"></div>
                <span>Checking</span>
            </div>
        </div>

        <div class="section">
            <h2>üñºÔ∏è Graphics</h2>
            <div class="asset-list" id="graphicsList">
                <!-- Graphics will be populated here -->
            </div>
        </div>

        <div class="section">
            <h2>üîä Audio</h2>
            <div class="asset-list" id="audioList">
                <!-- Audio will be populated here -->
            </div>
        </div>

        <div class="section">
            <h2>üìÑ Scripts</h2>
            <div class="asset-list" id="scriptsList">
                <!-- Scripts will be populated here -->
            </div>
        </div>

        <div id="summary" class="summary" style="display: none;">
            <!-- Summary will be populated here -->
        </div>

        <div style="text-align: center;">
            <button class="btn" onclick="checkAssets()">üîÑ Recheck Assets</button>
            <a href="index-modular.html" class="btn btn-success" id="playBtn" style="display: none;">
                üéÆ Play Game
            </a>
            <a href="debug-modules.html" class="btn">üîß Debug Modules</a>
        </div>
    </div>

    <script>
        // Asset definitions
        const ASSETS = {
            graphics: [
                'assets/graphics/sprites/paddle.png',
                'assets/graphics/sprites/ball.png',
                'assets/graphics/sprites/brick-blue.png',
                'assets/graphics/sprites/brick-red-whole.png',
                'assets/graphics/sprites/brick-red-damaged.png',
                'assets/graphics/sprites/brick-green.png',
                'assets/graphics/sprites/brick-orange.png'
            ],
            audio: [
                'assets/music/GalacticRap.mp3',
                'assets/sounds/bounce-var1.wav',
                'assets/sounds/bounce-var2.wav',
                'assets/sounds/bounce-var3.wav',
                'assets/sounds/bounce-var4.wav',
                'assets/sounds/bounce-var5.wav',
                'assets/sounds/powerUp.wav',
                'assets/sounds/explosion.wav',
                'assets/sounds/death.wav'
            ],
            scripts: [
                'src/main.js',
                'src/config/constants.js',
                'src/config/gameConfig.js',
                'src/entities/Starfield.js',
                'src/entities/Brick.js',
                'src/entities/Powerup.js',
                'src/scenes/TitleScene.js',
                'src/scenes/MainScene.js',
                'src/scenes/GameOverScene.js',
                'src/scenes/VictoryScene.js',
                'src/systems/BrickSystem.js',
                'src/systems/PowerupSystem.js',
                'src/levels/LevelParser.js',
                'src/utils/gameUtils.js'
            ]
        };

        let checkResults = {
            graphics: {},
            audio: {},
            scripts: {}
        };

        let totalAssets = 0;
        let checkedAssets = 0;

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function updateProgress() {
            const progress = (checkedAssets / totalAssets) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent =
                `Checking assets... ${checkedAssets}/${totalAssets} (${Math.round(progress)}%)`;
        }

        function createAssetItem(path, category) {
            const item = document.createElement('div');
            item.className = 'asset-item';
            item.innerHTML = `
                <div class="asset-path">${path}</div>
                <div class="asset-status status-checking" id="status-${category}-${path.replace(/[^a-zA-Z0-9]/g, '-')}">
                    Checking...
                </div>
                <div class="asset-size" id="size-${category}-${path.replace(/[^a-zA-Z0-9]/g, '-')}">
                    -
                </div>
            `;
            return item;
        }

        function populateAssetLists() {
            const graphicsList = document.getElementById('graphicsList');
            const audioList = document.getElementById('audioList');
            const scriptsList = document.getElementById('scriptsList');

            // Clear existing content
            graphicsList.innerHTML = '';
            audioList.innerHTML = '';
            scriptsList.innerHTML = '';

            // Add headers
            const createHeader = (text) => `
                <div style="font-weight: bold; padding: 5px 0; border-bottom: 1px solid #444;">${text}</div>
                <div style="font-weight: bold; padding: 5px 0; border-bottom: 1px solid #444;">Status</div>
                <div style="font-weight: bold; padding: 5px 0; border-bottom: 1px solid #444;">Size</div>
            `;

            graphicsList.innerHTML = createHeader('Graphics Files');
            audioList.innerHTML = createHeader('Audio Files');
            scriptsList.innerHTML = createHeader('Script Files');

            // Add asset items
            ASSETS.graphics.forEach(path => {
                graphicsList.appendChild(createAssetItem(path, 'graphics'));
            });

            ASSETS.audio.forEach(path => {
                audioList.appendChild(createAssetItem(path, 'audio'));
            });

            ASSETS.scripts.forEach(path => {
                scriptsList.appendChild(createAssetItem(path, 'scripts'));
            });
        }

        async function checkAsset(path, category) {
            const statusId = `status-${category}-${path.replace(/[^a-zA-Z0-9]/g, '-')}`;
            const sizeId = `size-${category}-${path.replace(/[^a-zA-Z0-9]/g, '-')}`;

            try {
                const response = await fetch(path);
                const statusElement = document.getElementById(statusId);
                const sizeElement = document.getElementById(sizeId);

                if (response.ok) {
                    const contentLength = response.headers.get('content-length');
                    const size = contentLength ? parseInt(contentLength) : 0;

                    statusElement.textContent = 'Found';
                    statusElement.className = 'asset-status status-ok';
                    sizeElement.textContent = size > 0 ? formatFileSize(size) : 'Unknown';

                    checkResults[category][path] = { status: 'ok', size: size };
                } else {
                    statusElement.textContent = `Error ${response.status}`;
                    statusElement.className = 'asset-status status-error';
                    sizeElement.textContent = '-';

                    checkResults[category][path] = { status: 'error', error: response.status };
                }
            } catch (error) {
                const statusElement = document.getElementById(statusId);
                const sizeElement = document.getElementById(sizeId);

                statusElement.textContent = 'Missing';
                statusElement.className = 'asset-status status-error';
                sizeElement.textContent = '-';

                checkResults[category][path] = { status: 'error', error: error.message };
            }

            checkedAssets++;
            updateProgress();
        }

        function generateSummary() {
            const summary = document.getElementById('summary');
            const playBtn = document.getElementById('playBtn');

            let totalFound = 0;
            let totalMissing = 0;
            let totalSize = 0;

            Object.keys(checkResults).forEach(category => {
                Object.keys(checkResults[category]).forEach(path => {
                    const result = checkResults[category][path];
                    if (result.status === 'ok') {
                        totalFound++;
                        totalSize += result.size || 0;
                    } else {
                        totalMissing++;
                    }
                });
            });

            const totalAssets = totalFound + totalMissing;
            const successRate = (totalFound / totalAssets) * 100;

            let summaryClass = 'summary-success';
            let summaryText = `‚úÖ All ${totalFound} assets found! Game is ready to play.`;
            let canPlay = true;

            if (totalMissing > 0) {
                if (totalMissing > totalFound) {
                    summaryClass = 'summary-error';
                    summaryText = `‚ùå ${totalMissing} assets missing, ${totalFound} found. Game may not work properly.`;
                    canPlay = false;
                } else {
                    summaryClass = 'summary-warning';
                    summaryText = `‚ö†Ô∏è ${totalMissing} assets missing, ${totalFound} found. Game might have issues.`;
                }
            }

            summary.innerHTML = `
                <div>${summaryText}</div>
                <div style="margin-top: 10px; font-size: 14px; opacity: 0.8;">
                    Success Rate: ${successRate.toFixed(1)}% | Total Size: ${formatFileSize(totalSize)}
                </div>
            `;
            summary.className = `summary ${summaryClass}`;
            summary.style.display = 'block';

            if (canPlay) {
                playBtn.style.display = 'inline-block';
            } else {
                playBtn.style.display = 'none';
            }

            document.getElementById('progressText').textContent =
                `Asset check complete! ${totalFound} found, ${totalMissing} missing.`;
        }

        async function checkAssets() {
            // Reset state
            checkResults = { graphics: {}, audio: {}, scripts: {} };
            checkedAssets = 0;
            totalAssets = ASSETS.graphics.length + ASSETS.audio.length + ASSETS.scripts.length;

            // Hide previous results
            document.getElementById('summary').style.display = 'none';
            document.getElementById('playBtn').style.display = 'none';

            // Populate lists
            populateAssetLists();

            // Start checking
            updateProgress();

            // Check all assets
            const promises = [];

            Object.keys(ASSETS).forEach(category => {
                ASSETS[category].forEach(path => {
                    promises.push(checkAsset(path, category));
                });
            });

            // Wait for all checks to complete
            await Promise.all(promises);

            // Generate summary
            generateSummary();
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            checkAssets();
        });

        // Handle errors
        window.addEventListener('error', (event) => {
            console.error('Error:', event.error);
        });
    </script>
</body>
</html>
